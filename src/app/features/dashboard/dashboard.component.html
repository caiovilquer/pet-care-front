<div class="dashboard-container">
  <!-- Loading State -->
  @if (isLoading) {
    <div class="loading-container">
      <div class="loading-card">
        <mat-spinner diameter="60"></mat-spinner>
        <h2>Carregando seu dashboard...</h2>
        <p>Buscando informações dos seus pets e eventos</p>
      </div>
    </div>
  } @else {
    <!-- Main Content -->
    <div class="dashboard-header">
      <h1>Dashboard</h1>
      @if (currentUser) {
        <p>Bem-vindo, {{currentUser.firstName}}!</p>
      } @else {
        <p>Bem-vindo! Alguns dados podem não estar disponíveis no momento.</p>
        <button mat-raised-button color="primary" (click)="retryLoadData()">
          <mat-icon>refresh</mat-icon>
          Tentar novamente
        </button>
      }
    </div>

    <div class="stats-grid">
    <mat-card class="stat-card">
      <mat-card-header>
        <div mat-card-avatar class="stat-icon pets-icon">
          <mat-icon>pets</mat-icon>
        </div>
        <mat-card-title>{{totalPets}}</mat-card-title>
        <mat-card-subtitle>Pets cadastrados</mat-card-subtitle>
      </mat-card-header>
      <mat-card-actions>
        <button mat-button routerLink="/pets">Ver pets</button>
      </mat-card-actions>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-header>
        <div mat-card-avatar class="stat-icon events-icon">
          <mat-icon>event</mat-icon>
        </div>
        <mat-card-title>{{totalEvents}}</mat-card-title>
        <mat-card-subtitle>Eventos agendados</mat-card-subtitle>
      </mat-card-header>
      <mat-card-actions>
        <button mat-button routerLink="/events">Ver eventos</button>
      </mat-card-actions>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-header>
        <div mat-card-avatar class="stat-icon urgent-icon">
          <mat-icon>warning</mat-icon>
        </div>
        <mat-card-title>{{upcomingEvents}}</mat-card-title>
        <mat-card-subtitle>Eventos próximos (7 dias)</mat-card-subtitle>
      </mat-card-header>
      <mat-card-actions>
        <button mat-button routerLink="/events">Ver eventos</button>
      </mat-card-actions>
    </mat-card>
  </div>

  <div class="content-grid">
    <mat-card class="recent-pets-card">
      <mat-card-header>
        <mat-card-title>Meus Pets</mat-card-title>
        <mat-card-subtitle>Pets cadastrados recentemente</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <mat-list *ngIf="recentPets.length > 0; else noPets">
          <mat-list-item *ngFor="let pet of recentPets">
            <mat-icon matListItemIcon>pets</mat-icon>
            <div matListItemTitle>{{pet.name}}</div>
            <div matListItemLine>{{pet.specie}}</div>
          </mat-list-item>
        </mat-list>
        <ng-template #noPets>
          @if (currentUser) {
            <p class="no-data">Nenhum pet cadastrado ainda.</p>
          } @else {
            <p class="no-data">Não foi possível carregar os pets no momento.</p>
          }
        </ng-template>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button routerLink="/pets">Ver todos</button>
        <button mat-raised-button color="primary" routerLink="/pets">
          <mat-icon>add</mat-icon>
          Cadastrar pet
        </button>
      </mat-card-actions>
    </mat-card>

    <mat-card class="recent-events-card">
      <mat-card-header>
        <mat-card-title>Próximos Eventos</mat-card-title>
        <mat-card-subtitle>Eventos agendados para os próximos 7 dias</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <mat-list *ngIf="recentEvents.length > 0; else noEvents">
          <mat-list-item *ngFor="let event of recentEvents">
            <mat-icon matListItemIcon [class]="'event-icon-' + event.type.toLowerCase()">{{getEventIcon(event.type)}}</mat-icon>
            <div matListItemTitle>{{getEventTypeName(event.type)}}</div>
            <div matListItemLine>{{event.description}} - {{formatDate(event.dateStart)}}</div>
          </mat-list-item>
        </mat-list>
        <ng-template #noEvents>
          @if (currentUser) {
            <p class="no-data">Nenhum evento próximo.</p>
          } @else {
            <p class="no-data">Não foi possível carregar os eventos no momento.</p>
          }
        </ng-template>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button routerLink="/events">Ver todos</button>
        <button mat-raised-button color="primary" routerLink="/events">
          <mat-icon>add</mat-icon>
          Novo evento
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
  } <!-- Fim do @else -->
</div>
